# HTTPS
## 一.https的简介
### 1.https的组成
https 等于 http + TLS/SSL
### 2.目的
解决http明文传输不安全的问题
### 3.端口
443
### 4.特性
- 机密性
- 完整性
- 身份认证
- 不可否认

## 二.加密
### 1.对称加密
- 加密和解密的密钥是同一个
- 危害：密钥在传输过程中被人拦截，将会导致传输的内容被解密
### 2.非对称加密
公钥和私钥有个特别的“**单向**”性，虽然都可以用来加密解密，但公钥加密后只能用私钥解密，反过来，私钥加密后也只能用公钥解密。

### 2.混合加密
#### 为什么不只有非对称加密？
- 非对称加密的产生的文件较大
- 非对称加密速度比较慢

#### 混合加密
- 非对称加密，加密对称加密的密钥
- 对称加密，加密传输的内容

![[混合加密.png]]


## 三.完整性
### 1.摘要算法
摘要算法保证了“数字摘要”和原文是完全等价的。所以，我们只要在原文后附上它的摘要，就能够保证数据的完整性。
原文经过摘要算法处理可以得到摘要
![[摘要算法.png]]
### 2.结合私钥
使用私钥再加上摘要算法，就能够实现“**数字签名**”，同时实现“身份认证”和“不可否认”

数字签名的原理其实很简单，就是把公钥私钥的用法反过来，之前是公钥加密、私钥解密，现在是私钥加密、公钥解密。

但又因为非对称加密效率太低，所以私钥只加密原文的摘要，这样运算量就小的多，而且得到的数字签名也很小，方便保管和传输。
![[签名和验签.png]]
### 3.总结
1.  摘要算法用来实现完整性，能够为数据生成独一无二的“指纹”，常用的算法是 SHA-2；
2.  数字签名是私钥对摘要的加密，可以由公钥解密后验证，实现身份认证和不可否认；
3.  公钥的分发需要使用数字证书，必须由 CA 的信任链来验证，否则就是不可信的；
4.  作为信任链的源头 CA 有时也会不可信，解决办法有 CRL、OCSP，还有终止信任。

### 4.数字证书/CA
- CA用来颁发公钥，私钥由自己保存
- 小一点的 CA 可以让大 CA 签名认证，但链条的最后，也就是**Root CA**，就只能自己证明自己了

## 四.https连接流程

### 1.Client Hello
客服端把TLS的版本，客户端支持的加密套件，生成的随机数C传递给服务端
### 2.Server Hello
服务端确认TLS版本，选择一个客户端支持的加密套件，和生成的随机数S传递给客户端
### 3.下发证书
服务端把CA帧数和公钥发给客户端
### 4.校验证书发送
客户端判断证书是否有效
### 5.客户端发送Pre-Master给服务端
Pre-Master：根据两个随机数根据选择的加密套件得到一个随机数

客户端用公钥加密Pre-Master后发送给服务端
客户端和服务器手里有了三个随机数：**Client Random、Server Random 和 Pre-Maste**
两端便可以使用这 3 个随机数独立生成对称加密**会话密钥**

### 6.Client 握手结束通知
-   Client 将之前的握手信息的所有参数通过摘要算法加密，让服务端验证
-   Client 发送握手结束消息，后面使用对称加密通信

### 7.Server 握手通知结束
-   Client 计算之前的握手信息的 hash 值，并与 P2 解密 Server 发送的握手信息的 hash 对比校验
-   验证通过后，开始发起 HTTPS 请求。

![[https握手详细解释.png]]